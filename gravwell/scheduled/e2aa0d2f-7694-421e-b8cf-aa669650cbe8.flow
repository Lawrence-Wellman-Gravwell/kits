{"id":"gravwell@0.0.1","nodes":{"1":{"id":1,"data":{"sleep":{"type":"Constant","value":30},"__meta":{"nickname":null,"notes":null,"inputs":[],"values":{"sleep":{"type":{"kind":"int"},"value":30}}}},"inputs":{"in":{"connections":[]}},"outputs":{"out":{"connections":[{"node":2,"input":"in","data":{}}]}},"position":[176,352],"name":"Sleep"},"2":{"id":2,"data":{"querystring":{"type":"Constant","value":"tag=* length\n| stats -maxtracked $AGG_TAGS_MT sum(length) as bytes count as entries by TAG \n| sort by bytes desc \n| table TAG entries bytes"},"duration":{"type":"Variable","value":"flow.Interval"},"name":{"type":"Constant","value":"search"},"__meta":{"nickname":null,"notes":null,"inputs":[],"values":{"querystring":{"type":{"kind":"string:query"},"value":"tag=* length\n| stats -maxtracked $AGG_TAGS_MT sum(length) as bytes count as entries by TAG \n| sort by bytes desc \n| table TAG entries bytes"},"duration":{"type":{"kind":"variable","default":"flow.Interval"},"value":"flow.Interval"},"name":{"type":{"kind":"string","default":"search"},"value":"search"}}}},"inputs":{"in":{"connections":[{"node":1,"output":"out","data":{}}]}},"outputs":{"out":{"connections":[{"node":3,"input":"in","data":{}}]}},"position":[448,352],"name":"RunQuery"},"3":{"id":3,"data":{"tag":{"type":"Constant","value":"_aggs_tags"},"input":{"type":"Variable","value":"search"},"splitlines":{"type":"Constant","value":false},"__meta":{"nickname":null,"notes":null,"inputs":[],"values":{"tag":{"type":{"kind":"string"},"value":"_aggs_tags"},"input":{"type":{"kind":"variable"},"value":"search"},"splitlines":{"type":{"kind":"boolean"},"value":false}}}},"inputs":{"in":{"connections":[{"node":2,"output":"out","data":{}}]}},"outputs":{"out":{"connections":[]}},"position":[752,352],"name":"Ingest"},"4":{"id":4,"data":{"__meta":{"inputs":[],"values":{},"nickname":"Note","notes":"Sleep to make sure any recent entries have made it into the indexer before we query."}},"inputs":{},"outputs":{},"position":[176,304],"name":"Annotation"},"5":{"id":5,"data":{"__meta":{"inputs":[],"values":{},"nickname":"Note","notes":"Now count how many entries/bytes are in each tag"}},"inputs":{},"outputs":{},"position":[448,304],"name":"Annotation"},"6":{"id":6,"data":{"__meta":{"inputs":[],"values":{},"nickname":"Note","notes":"Note that manually running this script multiple times will result in multiple copies of the same aggregates being ingested."}},"inputs":{},"outputs":{},"position":[752,432],"name":"Annotation"},"7":{"id":7,"data":{"__meta":{"inputs":[],"values":{},"nickname":"Note","notes":"This query runs over the interval from the *previous* flow execution up to the *scheduled* execution time of the flow. This means that if the flow is scheduled to run every hour, the query will run from *exactly* e.g. 14:00 to 15:00, despite the sleep node at the start of the flow."}},"inputs":{},"outputs":{},"position":[448,432],"name":"Annotation"},"8":{"id":8,"data":{"__meta":{"inputs":[],"values":{},"nickname":"Note","notes":"Re-ingest the results"}},"inputs":{},"outputs":{},"position":[752,304],"name":"Annotation"}}}
